<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VibeXXX - Pro Video Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: #111; /* Dark background */
            color: #fff; /* White text */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 900px; /* Wider for video player */
            width: 100%;
            background-color: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            padding: 30px;
            margin-top: 20px;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ff3366;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 51, 102, 0.7);
        }
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .access-denied {
            background-color: #330000;
            border: 2px solid #f44336;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-top: 50px;
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
            max-width: 500px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        .access-denied h2 {
            color: #f44336;
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: 800;
        }
        .access-denied p {
            font-size: 1.2em;
            color: #ddd;
            margin-bottom: 30px;
        }
        .access-denied a {
            display: inline-block;
            background-color: #ff3366;
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .access-denied a:hover {
            background-color: #e6005c;
        }
        .verifying-access {
            text-align: center;
            margin-top: 50px;
            font-size: 1.8em;
            color: #ff3366;
            font-weight: 600;
        }
        .verifying-access .spinner {
            border: 8px solid rgba(255, 51, 102, 0.2);
            border-top: 8px solid #ff3366;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .back-button {
            background-color: #444;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            margin-top: 20px;
            display: inline-block;
            text-decoration: none;
        }
        .back-button:hover {
            background-color: #555;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="videoTitle">Loading Video...</h1>

        <div id="videoPlayerSection" class="hidden">
            <div class="video-wrapper">
                <iframe id="videoIframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <p id="videoDescription" class="text-gray-300 text-lg"></p>
        </div>

        <div id="accessDenied" class="hidden access-denied">
            <h2>Access Denied!</h2>
            <p>This content is exclusive to Pro Members. Become a Pro Member to unlock all videos and features!</p>
            <a href="membership.html">Become a Pro Now!</a>
        </div>

        <div id="verifyingAccess" class="verifying-access">
            <div class="spinner"></div>
            <p>Verifying Access...</p>
            <p class="text-sm text-gray-400">Please wait while we confirm your Pro Membership.</p>
        </div>

        <a href="unlocked_videos.html" class="back-button">‚Üê Back to Pro Videos</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Firebase Configuration (same as your other client-side files)
        const firebaseConfig = {
            apiKey: "AIzaSyCc9N4rRu5-pjvOPDq78FUzQ2Bh2fuHyQ8",
            authDomain: "vibexxx-500c6.firebaseapp.com",
            projectId: "vibexxx-500c6",
            storageBucket: "vibexxx-500c6.firebasestorage.app",
            messagingSenderId: "880697212397",
            appId: "1:880697212397:web:b47c4b1d1dadcb6e5bbbe4"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // UI Elements
        const videoTitleElement = document.getElementById('videoTitle');
        const videoIframe = document.getElementById('videoIframe'); // Changed from youtubePlayer
        const videoPlayerSection = document.getElementById('videoPlayerSection');
        const videoDescriptionElement = document.getElementById('videoDescription');
        const accessDeniedSection = document.getElementById('accessDenied');
        const verifyingAccessSection = document.getElementById('verifyingAccess');

        // Function to get query parameters from URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // --- Video Data (All your Pro Videos - MUST MATCH unlocked_videos.html) ---
        const videoData = {
            "video_nier_automata": {
                title: "ü§ñ 2B's Wild Ride: Nier Automata Housemaid Unleashed! üí•",
                description: "Witness 2B like never before! Intense fuckmachine action with BBC creampie.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/54234/housemaid-2b-from-nier-automata",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/MAID.png"
            },
            "video_anime_big_ass": {
                title: "üçë Anime Babe's Thigh-High Cum Beg! üí¶",
                description: "A busty anime girl begs for a massive cumshot on her thighs. Uncensored action!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/49116/anime-girl-with-big-ass-begs-for",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_32.png"
            },
            "video_dva_bbc": {
                title: "ü•õ D.Va's Creamy Night: Milk This 12-Inch BBC! üçÜ",
                description: "Overwatch's D.Va gets wild with a massive BBC. Prepare for intense action!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/34807/dva-wanna-milk-this-12-inch-bbc",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_599.png"
            },
            "video_stepmom_milky": {
                title: "üçº Stepmom's Milky Tits: Can't Get Enough! ü§§",
                description: "Obsessed with stepmom's huge, milky tits. A forbidden fantasy come true.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/82878/i-cant-get-enough-of-my-stepmoms",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_1366068.png"
            },
            "video_stepsister_gangbang": {
                title: "üòà Naughty Stepsister: Dominated by Three Hung Studs! ‚õìÔ∏è",
                description: "A shy stepsister gets a rough gangbang from three hung studs. Uncensored hentai!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/98463/naughty-stepsister-dominated-and",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_53452.png"
            },
            "video_party_bang": {
                title: "ü§´ Secret Party Bang: Don't Tell Your Girlfriend! üéâ",
                description: "A wild party night leads to an unforgettable, rough bang. Keep it a secret!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/84310/dont-tell-your-girlfriend-about",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_265460.png"
            },
            "video_step_siblings_busted": {
                title: "üö® Busted! Step Siblings Caught in Uncensored Hentai! üò±",
                description: "A shocking discovery as step-siblings are caught in the act by their aunt.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/32090/step-siblings-busted-banging-by",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_45251.png"
            },
            "video_lewdfroggo_licking": {
                title: "üëÖ Rainy Day Bliss: Lewdfroggo's Hairless Babe Licking! üí¶",
                description: "Hot rainy day fun with a lewdfroggo and a hairless babe. So hot! üòú",
                iframeSrc: "https://www.animehentaivideos.xxx/v/43087/rainy-day-fun-with-lewdfroggo",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_83406.png"
            },
            "video_busty_teen_married": {
                title: "ü§Ø Busty Teen's Secret Affair: Banging a Married Man! ü§´",
                description: "Can you believe this busty teen is having a scandalous affair? See it all!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/32702/hey-can-you-believe-this-busty",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_3118.png"
            },
            "video_h_cup_nurse": {
                title: "ü©∫ Wild H-Cup Nurse: Sucks & Fucks Hard in POV! üçë",
                description: "A massive H-Cup nurse delivers intense POV action. Get ready for a wild ride!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/33446/wild-h-cup-nurse-babe-sucks-and",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/01.jpg"
            },
            "video_himawarigayorunisaku": {
                title: "üå∏ Himawarigayorunisaku: Teen Takes Anal & Cock! üí•",
                description: "Watch a teen suck big cock and take intense anal action. Her tits will shake!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/92366/hentai-himawarigayorunisaku-1",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/324541_sucking_hentai_anal_01.jpg"
            },
            "video_projekt_passion": {
                title: "üåå Projekt Passion: Dark Alien Babe's Shower Fingering! üëΩ",
                description: "Experience intense lesbian fingering with a dark alien babe in a shower game novel.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/92366/hentai-himawarigayorunisaku-1", // Note: This iframe src is duplicated from above, please verify if it's correct for this video.
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/07.jpg"
            },
            "video_tifa_futa": {
                title: "üî• Tifa Futa's Wild Ride: Banging Aerith Hard! üçë",
                description: "Tifa Futa delivers wild cum action in a big ass play with Aerith. Don't miss this!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/92882/tifa-futa-bangs-aerith-hard-damn",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/07-1.jpg"
            },
            "video_accidental_sex": {
                title: "üí¶ Kinky Pussy Rubbing: Accidental Sex & Hot Cumshot! üòú",
                description: "An unexpected encounter leads to kinky pussy rubbing and a hot cumshot finish.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/54123/accidental-sex-from-kinky-pussy",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/09.jpg"
            },
            "video_cosplayer_stepdaughter": {
                title: "ü§Ø Banged My Sexy Cosplayer Stepdaughter! üíñ",
                description: "A hot, forbidden encounter with a huge-titted cosplayer stepdaughter. So hot!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/82358/uhh-i-banged-my-sexy-cosplayer",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/04.jpg"
            },
            "video_stepsister_ass": {
                title: "üçë Stepsister's Perfect Ass: Virgin Anal Attempt! üçÜ",
                description: "A perfect ass takes a huge cock for a daring virgin anal attempt. Intense!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/87467/stepsisters-perfect-ass-takes",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/05.jpg"
            },
            "video_stepbrother_masturbation": {
                title: "ü§´ My Stepbrother's Craving: Helping with Masturbation! üòà",
                description: "A forbidden desire as a stepbrother helps with masturbation. A kinky secret!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/82151/my-stepbrother-admits-craving",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/18.jpg"
            },
            "video_elf_blindfolded": {
                title: "üßù‚Äç‚ôÄÔ∏è Elf Banging Night Elf: Blindfolded Kitchen Parody! üç≥",
                description: "A hilarious and kinky parody: elf banging night elf, blindfolded in the kitchen.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/34552/elf-banging-night-elf-blindfolded",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/04-1.jpg"
            },
            "video_tifa_lockhart_3d": {
                title: "üéÆ Tifa Lockhart's Tight Fantasy: 3D Sex Gameplay! üí•",
                description: "Damn! Tifa Lockhart delivers intense 3D sex gameplay action. A must-see!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/76524/damn-tifa-lockharts-tight",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/14.jpg"
            },
            "video_tifa_overwatch": {
                title: "üî´ Tifa & Friends: Overwatch HMV Action! ü§©",
                description: "Hey, wanna see Tifa and friends in wild Overwatch HMV action? Explosive!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/70203/hey-wanna-see-tifa-and-friends",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/10.jpg"
            },
            "video_milfs_penetrated": {
                title: "üî• MILFs Deeply Penetrated: Massive Cocks in Wild Hentai! ü§Ø",
                description: "Mature ladies get intensely penetrated by massive cocks in wild hentai scenes.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/34976/milfs-deeply-penetrated-by-massive",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/02.jpg"
            },
            "video_anime_girls_twerking": {
                title: "üëØ‚Äç‚ôÄÔ∏è Anime Girls Twerking for Blowjob Action! üíñ",
                description: "Watch as anime girls twerk their way to intense blowjob action. Hot!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/69949/anime-girls-twerking-for-blowjob",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/18-1.jpg"
            },
            "video_petite_asian_creampied": {
                title: "üå∏ Petite Asian's First Creampie: Uncensored Hentai! üí¶",
                description: "A tight pussy gets creampied in her first uncensored hentai adventure. Intense!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/84012/petite-asians-tight-pussy-creampied",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/videoframe_78834.png"
            },
            "video_jill_valentine_doggystyle": {
                title: "üêï‚Äçü¶∫ MILF Slut Jill Valentine: Begs for Big Cock in Doggystyle! ü•µ",
                description: "Resident Evil's Jill Valentine gets wild, begging for big cock in doggystyle.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/82014/milf-slut-jill-valentine-begs",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/09-1.jpg"
            },
            "video_claire_jill_blowjob": {
                title: "üëØ‚Äç‚ôÄÔ∏è Claire & Jill: Resident Evil Hentai Blowjob! üçÜ",
                description: "Yo, Claire and Jill deliver an uncensored blowjob in this Resident Evil hentai!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/82944/yo-claire-and-jill-blowjob-in",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/17.jpg"
            },
            "video_kanzaki_chan_creampie": {
                title: "üíñ Kanzaki-chan's Unreal Blowjob & Creampie! ü§§",
                description: "Obsessed with her slender, big-breasted body. Her blowjob before creampie is unreal!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/91745/im-obsessed-with-kanzaki-chans",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/13.jpg"
            },
            "video_pound_tight_asshole": {
                title: "üçë Why Finger When I Can Pound Your Tight Asshole Hard? üí•",
                description: "Forget fingering, it's time to pound that tight asshole hard. Intense action!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/74467/why-finger-when-i-can-pound-your",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/08.jpg"
            },
            "video_roommate_fucked": {
                title: "üè° Home Alone: Roommate Fucked Me During Panty Teasing! ü§´",
                description: "A kinky surprise at home: roommate fucked me during panty teasing. Wild!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/72766/i-was-home-alone-when-my-roommate",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/19.jpg"
            },
            "video_shy_pianist": {
                title: "üéπ Shy Pianist: Rides Massive Cock in Tight Hole! ü•µ",
                description: "A shy pianist takes on a massive cock, riding deep in her tight hole. Intense!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/69503/shy-pianist-rides-a-massive-cock",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/05-1.jpg"
            },
            "video_huge_titted_cutie": {
                title: "ü§Ø Wow! Huge-Titted Cutie: Wild 3-Way Blowjob & Creampie! üí¶",
                description: "A stunning cutie delivers a wild 3-way blowjob and creampie. Unbelievable!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/68001/wow-huge-titted-cutie-in-wild",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/09-2.jpg"
            },
            "video_homemade_squirting": {
                title: "üí¶ Ever Seen Real Homemade Fingering & Squirting Like This? ü§©",
                description: "Witness authentic homemade fingering and explosive squirting. Uncensored!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/44574/ever-seen-real-homemade-fingering",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/09-3.jpg"
            },
            "video_uraraka_midoria": {
                title: "üí• Hentai Uraraka & Midoria: Steamy Anime Action! üíñ",
                description: "My Hero Academia's Uraraka and Midoria in a steamy, action-packed hentai scene.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/95189/hentai-uraraka-and-midoria-in",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/02-1.jpg"
            },
            "video_madre_e_hijo": {
                title: "üë©‚Äçüë¶ Madre E Hijo: Steamy Hentai Creampie Action! üí¶",
                description: "A forbidden bond in steamy hentai creampie action. Intense and shocking!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/43270/madre-e-hijo-in-steamy-hentai",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/06.jpg"
            },
            "video_wet_doggystyle": {
                title: "üê∂ What's Hotter? Steamy, Wet Doggystyle in Anime! ü•µ",
                description: "Dive into a steamy, wet doggystyle session in anime. Pure raw passion!",
                iframeSrc: "https://www.animehentaivideos.xxx/v/72376/whats-hotter-than-a-steamy-wet",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/13-1.jpg"
            },
            "video_bbw_cuckold": {
                title: "üçë 3D BBW Hot Mature: Cuckold Sex with BBC Creampie! üçÜ",
                description: "A hot mature BBW engages in cuckold sex with a big black cock for an intense creampie.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/92169/3d-bbw-hot-mature-engages-in-cuckold",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/19-1.jpg"
            },
            "video_sissy_ladyboy": {
                title: "üíÖ Sissy Ladyboy: Devours Ass in Wild Trans Threesome! üíñ",
                description: "A sissy ladyboy gets wild, devouring ass while being banged in a trans threesome group.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/91291/sissy-ladyboy-devours-ass-while",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/17-1.jpg"
            },
            "video_friends_girlfriend": {
                title: "ü§´ Stuffing My Friend's Girlfriend's Tight Vagina! üí¶",
                description: "A wild night of fucking leads to stuffing a friend's girlfriend's tight vagina with cum.",
                iframeSrc: "https://www.animehentaivideos.xxx/v/66886/stuffing-my-friends-girlfriends",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/19-2.jpg"
            },
            "video_brickzilla_freya": {
                title: "ü¶ç Brickzilla's BBC Dominates Freya Von Doom! üí•",
                description: "Brickzilla's massive BBC takes on Freya Von Doom's petite frame. Intense domination!",
                iframeSrc: "https://www.blacksexvideos.xxx/v/27905/brickzillas-bbc-dominates-freya",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/02-2.jpg"
            },
            "video_black_beauty_boss": {
                title: "üëë Black Beauty: Boss's Cock in Her Mouth! ü•µ",
                description: "A stunning black beauty gets her boss's cock in her mouth. Forbidden office fantasy!",
                iframeSrc: "https://www.blacksexvideos.xxx/v/60000/black-beauty-gets-her-bosss",
                thumbnail: "http://luxflix.free.nf/wp-content/uploads/2025/07/15.jpg"
            }
        };

        // --- Access Check Logic ---
        async function checkUserAccess() {
            verifyingAccessSection.classList.remove('hidden');
            videoPlayerSection.classList.add('hidden');
            accessDeniedSection.classList.add('hidden');
            videoTitleElement.textContent = "Verifying Access...";

            const user = auth.currentUser;
            const videoIdParam = getQueryParam('id'); // Get video ID from URL

            if (!user) {
                console.log("No user logged in. Access denied.");
                accessDeniedSection.classList.remove('hidden');
                verifyingAccessSection.classList.add('hidden');
                videoTitleElement.textContent = "Access Denied!";
                return;
            }

            if (!videoIdParam || !videoData[videoIdParam]) {
                console.error("Invalid video ID or video not found.");
                videoTitleElement.textContent = "Video Not Found";
                verifyingAccessSection.classList.add('hidden');
                // Optionally show a custom "Video Not Found" message or redirect
                accessDeniedSection.classList.remove('hidden'); // Fallback to access denied
                return;
            }

            try {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists && userDoc.data().unlocked_access) {
                    const subscriptionEndDate = userDoc.data().subscriptionEndDate;
                    if (subscriptionEndDate && subscriptionEndDate.toDate() > new Date()) {
                        // User has unlocked access and subscription is active
                        const videoInfo = videoData[videoIdParam];
                        videoTitleElement.textContent = videoInfo.title;
                        videoDescriptionElement.textContent = videoInfo.description;
                        videoIframe.src = videoInfo.iframeSrc; // Use iframeSrc directly
                        videoPlayerSection.classList.remove('hidden');
                        verifyingAccessSection.classList.add('hidden');
                        console.log(`User has Pro Access. Loading video: ${videoInfo.title}`);
                    } else {
                        // Access expired or not set correctly
                        accessDeniedSection.classList.remove('hidden');
                        verifyingAccessSection.classList.add('hidden');
                        videoTitleElement.textContent = "Access Denied!";
                        console.log("User's Pro Access is expired or not active.");
                    }
                } else {
                    // User document doesn't exist or unlocked_access is false
                    accessDeniedSection.classList.remove('hidden');
                    verifyingAccessSection.classList.add('hidden');
                    videoTitleElement.textContent = "Access Denied!";
                    console.log("User does not have Pro Access (document missing or flag false).");
                }
            } catch (error) {
                console.error("Error fetching user access status for video:", error);
                accessDeniedSection.classList.remove('hidden'); // Show denied on error
                verifyingAccessSection.classList.add('hidden');
                videoTitleElement.textContent = "Access Denied!";
                alert("Error checking access. Please try again later.");
            }
        }

        // Listen for Firebase Auth state changes
        auth.onAuthStateChanged(user => {
            checkUserAccess(); // Re-check access and load video whenever auth state changes
        });

        // Initial load on page load
        document.addEventListener('DOMContentLoaded', checkUserAccess);
    </script>
</body>
</html>